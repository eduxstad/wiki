<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
<meta name="description" content="Documentation for configuration on Diode">
<meta name="keywords" content="example, purdue, wiki">

    <title>Diode Documentation | PurdueLUG Wiki</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script> 
    <script src="/wiki/static/mustachejs/mustache.js"></script>
    <link rel="stylesheet" href="/wiki/static/style/style.css">
    <link rel="icon" type="image/png" sizes="32x32" href="/wiki/static/style/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/wiki/static/style/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/wiki/static/style/favicon-16x16.png"> 
    <style type="text/css">
    @import url("/wiki/static/fonts/fontawesome.css");
    /* fontawesome */
    [class*="fontawesome-"]:before {
      font-family: 'FontAwesome', sans-serif;
    }
    </style> 
    <script>
    // Globals
    var has_gaq = false;
    </script>
    <!-- no style head.html found -->
</head>
<body>

<div id="content" class="container">
<div class="top-menu">
<div class="container">
  <div class="top-menu-mob">
    <a class="top-menu-link" href="#" onclick="toggleMobMenu();"><span class="fontawesome-reorder"></span></a>
  </div>
  <div class="top-menu-full mob-hidden">
    
    <div class="top-menu-item">
      
        <a href="/wiki/index.html" class="top-menu-link">Welcome</a>
      
    </div>
  
    <div class="top-menu-item">
      
        <a href="/wiki/posts.html" class="top-menu-link">Posts</a>
      
    </div>
  
    <div class="top-menu-item">
      
        <a href="/wiki/search.html" class="top-menu-link">Search</a>
      
    </div>
  
    <div class="top-menu-item">
      
        <a href="http://pykwiki.nullism.com" class="top-menu-link">PyKwiki Docs</a>
      
    </div>
  
    <div class="top-menu-item-right">
      <form method="get" action="/wiki/search.html">
        <input type="text" name="q" class="input-text top-menu-search-field" placeholder="Search">
      </form>
    </div>
  </div>
</div>
    <div class="clear"></div>
</div><!-- end top-menu -->

<script>
function menuClick(i) 
{
    if($("#submenu_"+i).is(":visible"))
    {
        $("#submenu_"+i).hide();
        $("#menuparent_"+i).removeClass('active');
    }
    else 
    {
        hideAllSubmenus();
        $("#submenu_"+i).show();
        $("#menuparent_"+i).addClass('active');
    }
    return false;
}

function hideAllSubmenus() {
    $('.submenu').hide();
    $('.top-menu-parent').removeClass('active');
}

var showMobMenu = false;
function toggleMobMenu() {
    if(showMobMenu) {
        $(".top-menu-full").addClass('mob-hidden');
    } else { 
        $(".top-menu-full").removeClass('mob-hidden');
    }
    showMobMenu = !showMobMenu;
    return false;
}
</script>

<script>
$(document).ready(function() { 
    $('.submenu').hide();
});

$(document).click(function(e) {
    var tgt = $(e.target);
    if(!tgt.is('.top-menu-parent') && !tgt.is('.fontawesome-caret-down')) {
        hideAllSubmenus();
    }
});
</script>


<script>
var tocOpen = true;
function toggleToc() { 
    if(tocOpen) { 
        hideToc();
    } else { 
        showToc();
    }
    return false;
}
function showToc() { 
    $(".toc").show();
    $(".toc-control").removeClass("toc-control-closed");
    $(".toc-control").addClass("toc-control-open");
    tocOpen = true;
}
function hideToc() { 
    $(".toc").hide();
    $(".toc-control").removeClass("toc-control-open");
    $(".toc-control").addClass("toc-control-closed");
    tocOpen = false;
}
</script>

<div class="post-wrap">

<!-- no style post.html found -->




<div class="post-content">
<div class="post">


<div class="post-author-block">
  Posted on <strong>2017-08-31 01:27</strong> by <strong>PLUG</strong>
</div>


<div class="post-tags">
  
  <div class="clear"></div>
</div>

<h1 id="lxc">LXC</h1>
<h2 id="command-examples">Command Examples</h2>
<p>Create new container
    sudo lxc-create -n plug -t fedora -B btrfs
    sudo vi /etc/lxc/dnsmasq.conf # see config examples</p>
<p>List existing containers
    sudo lxc-ls -f</p>
<p>Attach existing container
    sudo lxc-attach -n plug</p>
<h2 id="config-examples">Config Examples</h2>
<p><strong>/etc/lxc/lxc.conf</strong> - set path for containers to be stored (default /var/lib/lxc)
    lxc.lxcpath = "/lxc"</p>
<p><strong>/etc/lxc/default.conf</strong> - config options for all newly created containers to inherit
    lxc.network.type = veth
    lxc.network.link = lxcbr0
    lxc.network.flags = up
    lxc.network.hwaddr = 00:16:3e:xx:xx:xx
    lxc.start.auto = 1</p>
<div class="codehilite"><pre><span></span># address
#lxc.network.ipv4 = 192.168.1.1xx
lxc.network.ipv4.gateway = 192.168.1.1

# memory
lxc.cgroup.memory.limit_in_bytes = 512M

# memory + swap
lxc.cgroup.memory.memsw.limit_in_bytes = 1G
</pre></div>


<p><strong>/etc/default/lxc-net</strong> - it may be necessary to add /etc/lxc/dnsasq.conf to the apparmor profile (/etc/apparmor.d/<em>dnsmasq</em>) with read privileges
    USE_LXC_BRIDGE="true"
    LXC_BRIDGE="lxcbr0"
    LXC_ADDR="192.168.1.1"
    LXC_NETMASK="255.255.255.0"
    LXC_NETWORK="192.168.1.0/24"
    LXC_DHCP_RANGE="192.168.1.100,192.168.1.199"
    LXC_DHCP_MAX="100"
    LXC_DHCP_CONFILE="/etc/lxc/dnsmasq.conf"
    LXC_DOMAIN=""</p>
<p><strong>/etc/lxc/dnsmasq.conf</strong>
    dhcp-host=evan,192.168.1.102</p>
<p><strong>iptables config</strong>
    #!/bin/bash
    ## Evan Widloski - 2016-11-11
    # Diode iptables rules</p>
<div class="codehilite"><pre><span></span># filter table: flush all chains, and delete all user added chains
iptables -F
iptables -X
# nat table: flush all chains, and delete all user added chains
iptables -t nat -F
iptables -t nat -X

# set default policies to DROP packets
iptables -P INPUT DROP
iptables -P OUTPUT DROP
iptables -P FORWARD DROP

# allow inbound outbound traffic on host 
iptables -A OUTPUT -o enp6s0f0 -d 0.0.0.0/0 -j ACCEPT 
iptables -A INPUT -i enp6s0f0 -m state --state ESTABLISHED,RELATED -j ACCEPT

# set up chain for sshguard
iptables -N sshguard
iptables -A INPUT -p tcp --dport 22 -j sshguard

# allow ssh
iptables -A INPUT -i enp6s0f0 -p tcp --dport 22 -m state --state NEW,ESTABLISHED -j ACCEPT
iptables -A OUTPUT -o enp6s0f0 -p tcp --sport 22 -m state --state ESTABLISHED -j ACCEPT

# allow mosh
iptables -A INPUT -i enp6s0f0 -p udp --dport 60000:61000 -j ACCEPT
iptables -A OUTPUT -o enp6s0f0 -p udp --sport 60000:61000 -j ACCEPT

# allow connections to varnish service
#iptables -A INPUT -i enp6s0f0 -p tcp --dport 80 -m state --state NEW,ESTABLISHED -j ACCEPT
#iptables -A OUTPUT -o enp6s0f0 -p tcp --sport 80 -m state --state ESTABLISHED -j ACCEPT

# allow host to access LXC targets via network
iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT
iptables -A OUTPUT -s 192.168.1.0/24 -j ACCEPT

# allow outbound traffic for lxc containers
iptables -A FORWARD -i lxcbr0 -j ACCEPT
iptables -t nat -A POSTROUTING -s 192.168.1.0/24 -j MASQUERADE

# after incoming packets have been NAT&#39;ed (see below), allow them to pass through
# the forward chain to their intended LXC target
iptables -A FORWARD -m state --state NEW,ESTABLISHED,RELATED -j ACCEPT

##------------ evan --------------
## ssh
iptables -t nat -A PREROUTING -p tcp --dport 20022 -j DNAT --to-destination 192.168.1.102:22
</pre></div>


</div><!-- end post -->
</div><!-- end post-content -->

</div><!-- end post-wrap -->

</div><!-- End #content -->
<div class="clear"></div>
<div id="footer">
    <!-- no style footer.html found -->
    <div class="container" style="text-align: center;">
        <div>
        <p class="text-muted credit">&copy; 2016 PurdueLUG Wiki
        &mdash; powered by <a href="http://pykwiki.nullism.com">PyKwiki</a>
        </p>
        </div>

        

        

        


        <div class="social-div">
            <a href="/wiki/rss.xml"
                class="icon-link"><b class="big-icon fontawesome-rss"></b>RSS</a>
        </div>

        <div class="clear"></div>
    </div>
</div>
</body>
</html>